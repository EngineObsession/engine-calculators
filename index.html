<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Engine Calculator Suite: Rod Length, Compression & Displacement (K20, LS3, 2JZ)</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1022968838583578" crossorigin="anonymous"></script>
    <meta name="description" content="Free automotive engineering calculators. Calculate connecting rod length, compression ratio, piston speed, and fuel injector sizing. Includes a database of specs for Honda, Ford, Chevy, and JDM engines.">
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Ultimate Engine Calculator Suite",
      "applicationCategory": "AutomotiveUtility",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "description": "Comprehensive automotive calculators for engine building, tuning, and drivetrain setup.",
      "featureList": "Rod Length Calculator, Compression Ratio, Mean Piston Speed, Rod Ratio, Injector Duty Cycle"
    }
    </script>

    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; padding: 20px; max-width: 1000px; margin: 0 auto; }
        
        h1, h2, h3 { color: #0f172a; }
        .hero { text-align: center; margin-bottom: 30px; }
        .hero p { color: #64748b; max-width: 600px; margin: 0 auto; }

        /* Tab Navigation */
        .tab-nav { display: flex; border-bottom: 2px solid #e2e8f0; margin-bottom: 20px; overflow-x: auto; }
        .tab-btn { padding: 12px 24px; border: none; background: none; font-weight: 600; color: #64748b; cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px; transition: 0.2s; white-space: nowrap; }
        .tab-btn:hover { color: var(--primary); }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        
        /* Content Areas */
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        
        /* Calculator Cards */
        .card { background: var(--card); padding: 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; }
        .card h3 { margin-top: 0; color: var(--primary); font-size: 1.1em; border-bottom: 1px solid #f1f5f9; padding-bottom: 10px; }
        
        /* Form Elements */
        label { display: block; font-size: 0.85em; font-weight: 500; margin-top: 10px; color: #475569; }
        .input-group { display: flex; gap: 10px; }
        input, select { width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 0.95em; margin-top: 4px; box-sizing: border-box; }
        input:focus { border-color: var(--primary); outline: none; }
        
        /* Results */
        .result-box { margin-top: 15px; background: #f1f5f9; padding: 10px; border-radius: 4px; font-weight: bold; text-align: center; color: var(--primary); font-family: monospace; font-size: 1.1em; }
        .calc-btn { width: 100%; background: var(--primary); color: white; border: none; padding: 10px; border-radius: 4px; font-weight: 600; margin-top: 15px; cursor: pointer; transition: 0.2s; }
        .calc-btn:hover { background: #1d4ed8; }

        /* SEO Text Padding */
        .info-block { background: #eff6ff; border-left: 4px solid var(--primary); padding: 15px; margin-top: 20px; border-radius: 0 4px 4px 0; }
        .info-block h4 { margin: 0 0 5px 0; color: #1e3a8a; }
        .info-block p { margin: 0; font-size: 0.9em; color: #334155; }

        /* Global Selector */
        .global-controls { background: #1e293b; color: white; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        .global-controls h2 { margin: 0 0 10px 0; font-size: 1.2em; }
        .global-controls select { background: #334155; color: white; border: 1px solid #475569; }

        /* Footer List */
        #engine-list-seo { margin-top: 50px; border-top: 1px solid #e2e8f0; padding-top: 20px; }
        #seo-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 10px; padding: 0; list-style: none; }
        #seo-list li { font-size: 0.85em; color: #64748b; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="hero">
        <h1>Engine Building Calculator Suite</h1>
        <p>Professional tools for engine geometry, fuel management, and drivetrain analysis.</p>
    </div>

    <div class="global-controls">
        <h2>ðŸ”§ Project Setup</h2>
        <label style="color: #94a3b8;">Select a base engine to auto-fill all calculators:</label>
        <select id="globalEngine" onchange="autoFillAll()">
            <option value="">-- Choose Engine Preset --</option>
            </select>
    </div>

    <div class="tab-nav">
        <button class="tab-btn active" onclick="switchTab('tab-engine')">Engine Internals</button>
        <button class="tab-btn" onclick="switchTab('tab-airfuel')">Air & Fuel</button>
        <button class="tab-btn" onclick="switchTab('tab-reliability')">Reliability</button>
        <button class="tab-btn" onclick="switchTab('tab-drivetrain')">Drivetrain</button>
    </div>

    <div id="tab-engine" class="tab-content active">
        <div class="grid-container">
            <div class="card">
                <h3>Displacement Calculator</h3>
                <label>Bore (mm)</label><input type="number" id="disp_bore" placeholder="86.0">
                <label>Stroke (mm)</label><input type="number" id="disp_stroke" placeholder="86.0">
                <label>Cylinders</label><input type="number" id="disp_cyl" placeholder="4">
                <button class="calc-btn" onclick="calcDisplacement()">Calculate</button>
                <div class="result-box" id="res_disp">--- cc / --- L</div>
            </div>

            <div class="card">
                <h3>Connecting Rod Length</h3>
                <label>Deck Height (mm)</label><input type="number" id="rod_deck" placeholder="212.0">
                <label>Stroke (mm)</label><input type="number" id="rod_stroke" placeholder="86.0">
                <label>Piston Comp. Height (mm)</label><input type="number" id="rod_comp_height" placeholder="30.0">
                <label>Deck Clearance (mm) <small>(0 = flush)</small></label><input type="number" id="rod_clearance" placeholder="0.0">
                <button class="calc-btn" onclick="calcRodLength()">Calculate Length</button>
                <div class="result-box" id="res_rod_len">--- mm</div>
            </div>

            <div class="card">
                <h3>Static Compression Ratio</h3>
                <label>Cylinder Vol (cc)</label><input type="number" id="cr_cylvol" readonly style="background:#e2e8f0">
                <label>Combustion Chamber (cc)</label><input type="number" id="cr_chamber" placeholder="e.g. 45">
                <label>Piston Dome/Dish (cc)</label><input type="number" id="cr_dome" placeholder="-2 (Dish)">
                <label>Head Gasket Thickness (mm)</label><input type="number" id="cr_gasket" placeholder="0.6">
                <button class="calc-btn" onclick="calcCR()">Calculate CR</button>
                <div class="result-box" id="res_cr">--- : 1</div>
            </div>

            <div class="card">
                <h3>Rod / Stroke Ratio</h3>
                <label>Rod Length (mm)</label><input type="number" id="rs_rod" placeholder="139.0">
                <label>Stroke (mm)</label><input type="number" id="rs_stroke" placeholder="86.0">
                <button class="calc-btn" onclick="calcRSRatio()">Calculate</button>
                <div class="result-box" id="res_rs">Ratio: ---</div>
            </div>
        </div>

        <div class="info-block">
            <h4>Understanding Engine Geometry</h4>
            
            <p><strong>Calculating Rod Length:</strong> When building a "stroker" engine, you are limited by the Block Deck Height. To find your required rod length, the formula is: <em>Deck Height - (Stroke Ã· 2) - Compression Height - Deck Clearance</em>. If you change your crankshaft to increase stroke, you must typically use a shorter connecting rod or a piston with a lower compression height (pin moved up).</p>
            <p><strong>Rod/Stroke Ratio:</strong> A higher ratio (above 1.75) reduces side-loading on the cylinder walls. This is why engines like the Honda F20C (Ratio 1.82) can rev to 9,000 RPM reliably.</p>
        </div>
    </div>

    <div id="tab-airfuel" class="tab-content">
        <div class="grid-container">
            <div class="card">
                <h3>Airflow (CFM)</h3>
                <label>Engine Size (Liters)</label><input type="number" id="cfm_liters">
                <label>Max RPM</label><input type="number" id="cfm_rpm" placeholder="7000">
                <label>Volumetric Eff. (%)</label><input type="number" id="cfm_ve" value="90">
                <button class="calc-btn" onclick="calcCFM()">Calculate CFM</button>
                <div class="result-box" id="res_cfm">--- CFM</div>
            </div>

            <div class="card">
                <h3>Fuel Injector Sizing</h3>
                <label>Target Horsepower (BHP)</label><input type="number" id="inj_hp" placeholder="300">
                <label>Number of Injectors</label><input type="number" id="inj_num" placeholder="4">
                <label>BSFC (0.5 NA / 0.65 Turbo)</label><input type="number" id="inj_bsfc" value="0.5">
                <label>Max Duty Cycle (%)</label><input type="number" id="inj_duty" value="80">
                <button class="calc-btn" onclick="calcInjectors()">Calculate</button>
                <div class="result-box" id="res_inj">--- cc/min</div>
            </div>
        </div>
        
        <div class="info-block">
            <h4>Injector Sizing Guide</h4>
            <p>When upgrading your fuel system, it is crucial to leave "headroom." We calculate based on a maximum <strong>Duty Cycle</strong> (usually 80-85%). Running injectors at 100% duty cycle can cause them to overheat and fail open.</p>
        </div>
    </div>

    <div id="tab-reliability" class="tab-content">
        <div class="grid-container">
            <div class="card">
                <h3>Mean Piston Speed</h3>
                <label>Stroke (mm)</label><input type="number" id="mps_stroke">
                <label>Max RPM</label><input type="number" id="mps_rpm" placeholder="8000">
                <button class="calc-btn" onclick="calcPistonSpeed()">Calculate</button>
                <div class="result-box" id="res_mps">--- ft/min</div>
            </div>

            <div class="card">
                <h3>Dynamic Compression (DCR)</h3>
                <label>Static CR</label><input type="number" id="dcr_static" placeholder="11.0">
                <label>Rod Length (mm)</label><input type="number" id="dcr_rod">
                <label>Stroke (mm)</label><input type="number" id="dcr_stroke">
                <label>Intake Closing (ABDC)</label><input type="number" id="dcr_ivc" placeholder="45">
                <button class="calc-btn" onclick="calcDCR()">Calculate DCR</button>
                <div class="result-box" id="res_dcr">--- : 1</div>
            </div>
        </div>
    </div>

    <div id="tab-drivetrain" class="tab-content">
        <div class="grid-container">
            <div class="card">
                <h3>Gear Ratio & Top Speed</h3>
                <label>Tire Diameter (inches)</label><input type="number" id="gear_tire" placeholder="24.5">
                <label>Final Drive Ratio</label><input type="number" id="gear_final" placeholder="4.10">
                <label>Gear Ratio</label><input type="number" id="gear_ratio" placeholder="0.85">
                <label>RPM</label><input type="number" id="gear_rpm" placeholder="7000">
                <button class="calc-btn" onclick="calcSpeed()">Calculate Speed</button>
                <div class="result-box" id="res_speed">--- mph</div>
            </div>

            <div class="card">
                <h3>Tire Size Compare</h3>
                <div class="input-group">
                    <input type="text" id="tire1" placeholder="205/55R16">
                    <input type="text" id="tire2" placeholder="225/45R17">
                </div>
                <button class="calc-btn" onclick="calcTireDiff()">Compare Diameters</button>
                <div class="result-box" id="res_tire">Diff: ---%</div>
            </div>
        </div>
    </div>

    <section id="engine-list-seo">
        <h3>Available Engine Specifications</h3>
        <p>Database includes Deck Height, Bore, and Stroke for the following engines:</p>
        <ul id="seo-list">
            </ul>
    </section>

<script>
    // --- 1. ENGINE DATABASE (Updated with Deck Height in mm) ---
    const engineDatabase = {
    // --- JDM (Honda, Toyota, Nissan, Subaru, Mitsubishi) ---
    "Honda B16A (Civic Si/Type R)": { bore: 81.0, stroke: 77.4, rod: 134.0, cyl: 4, cr: 10.2, deck: 203.9 },
    "Honda B18C1 (Integra GSR)": { bore: 81.0, stroke: 87.2, rod: 137.9, cyl: 4, cr: 10.0, deck: 212.4 },
    "Honda B18C5 (Integra Type R)": { bore: 81.0, stroke: 87.2, rod: 137.9, cyl: 4, cr: 11.1, deck: 212.4 },
    "Honda K20A2 (RSX Type S)": { bore: 86.0, stroke: 86.0, rod: 139.0, cyl: 4, cr: 11.0, deck: 212.0 },
    "Honda K24A2 (TSX)": { bore: 87.0, stroke: 99.0, rod: 152.0, cyl: 4, cr: 10.5, deck: 231.5 },
    "Honda F20C (S2000 AP1)": { bore: 87.0, stroke: 84.0, rod: 153.0, cyl: 4, cr: 11.7, deck: 224.0 },
    "Honda F22C (S2000 AP2)": { bore: 87.0, stroke: 90.7, rod: 149.65, cyl: 4, cr: 11.1, deck: 224.0 },
    "Toyota 4AGE (Corolla AE86)": { bore: 81.0, stroke: 77.0, rod: 122.0, cyl: 4, cr: 9.4, deck: 190.0 },
    "Toyota 1JZ-GTE (Supra/Chaser)": { bore: 86.0, stroke: 71.5, rod: 125.2, cyl: 6, cr: 8.5, deck: 203.0 },
    "Toyota 2JZ-GTE (Supra Mk4)": { bore: 86.0, stroke: 86.0, rod: 142.0, cyl: 6, cr: 8.5, deck: 219.0 },
    "Toyota 3S-GE (Altezza BEAMS)": { bore: 86.0, stroke: 86.0, rod: 138.0, cyl: 4, cr: 11.5, deck: 213.5 },
    "Nissan SR20DET (Silvia)": { bore: 86.0, stroke: 86.0, rod: 136.3, cyl: 4, cr: 8.5, deck: 211.3 },
    "Nissan RB26DETT (Skyline GT-R)": { bore: 86.0, stroke: 73.7, rod: 121.5, cyl: 6, cr: 8.5, deck: 183.75 }, 
    "Nissan RB30 (Patrol/Swap)": { bore: 86.0, stroke: 85.0, rod: 152.5, cyl: 6, cr: 9.0, deck: 232.75 },
    "Nissan VQ35DE (350Z)": { bore: 95.5, stroke: 81.4, rod: 144.2, cyl: 6, cr: 10.3, deck: 215.0 },
    "Nissan VR38DETT (R35 GT-R)": { bore: 95.5, stroke: 88.4, rod: 165.0, cyl: 6, cr: 9.0, deck: 228.0 },
    "Mitsubishi 4G63T (Evo 8/9)": { bore: 85.0, stroke: 88.0, rod: 150.0, cyl: 4, cr: 8.8, deck: 229.0 },
    "Mitsubishi 4B11T (Evo X)": { bore: 86.0, stroke: 86.0, rod: 143.75, cyl: 4, cr: 9.0, deck: 213.5 },
    "Subaru EJ205 (WRX 2.0L)": { bore: 92.0, stroke: 75.0, rod: 130.5, cyl: 4, cr: 8.0, deck: 201.0 },
    "Subaru EJ257 (STI 2.5L)": { bore: 99.5, stroke: 79.0, rod: 130.5, cyl: 4, cr: 8.2, deck: 201.0 },
    "Subaru FA20 (BRZ/GT86)": { bore: 86.0, stroke: 86.0, rod: 129.3, cyl: 4, cr: 12.5, deck: 205.5 },
    "Mazda MZR 2.3 DISI (Speed3)": { bore: 87.5, stroke: 94.0, rod: 150.5, cyl: 4, cr: 9.5, deck: 227.0 },

    // --- USDM (Chevy, Ford, Dodge) ---
    "Chevy Small Block 350 (Gen 1)": { bore: 101.6, stroke: 88.39, rod: 144.8, cyl: 8, cr: 9.0, deck: 229.2 }, 
    "Chevy LS1 (5.7L)": { bore: 99.0, stroke: 92.0, rod: 154.9, cyl: 8, cr: 10.1, deck: 234.7 }, 
    "Chevy LS3 (6.2L)": { bore: 103.25, stroke: 92.0, rod: 154.9, cyl: 8, cr: 10.7, deck: 234.7 },
    "Chevy LS7 (Z06 7.0L)": { bore: 104.8, stroke: 101.6, rod: 154.0, cyl: 8, cr: 11.0, deck: 234.7 },
    "Chevy LT4 (Supercharged 6.2L)": { bore: 103.25, stroke: 92.0, rod: 154.9, cyl: 8, cr: 10.0, deck: 234.7 },
    "Ford 302 Windsor (5.0L)": { bore: 101.6, stroke: 76.2, rod: 129.3, cyl: 8, cr: 9.0, deck: 208.4 }, 
    "Ford 4.6L Modular (2V GT)": { bore: 90.2, stroke: 90.0, rod: 150.7, cyl: 8, cr: 9.4, deck: 227.0 },
    "Ford 5.0L Coyote (Gen 1)": { bore: 92.2, stroke: 92.7, rod: 150.7, cyl: 8, cr: 11.0, deck: 227.0 }, 
    "Ford 5.2L Voodoo (GT350)": { bore: 94.0, stroke: 93.0, rod: 150.7, cyl: 8, cr: 12.0, deck: 227.0 },
    "Ford 7.3L Godzilla": { bore: 107.2, stroke: 101.0, rod: 160.5, cyl: 8, cr: 10.5, deck: 245.1 }, 
    "Ford Barra 4.0T (Falcon XR6)": { bore: 92.26, stroke: 99.31, rod: 152.0, cyl: 6, cr: 8.5, deck: 235.5 },
    "Dodge 5.7L Hemi": { bore: 99.5, stroke: 90.9, rod: 158.5, cyl: 8, cr: 9.6, deck: 234.9 }, 
    "Dodge 6.2L Hellcat": { bore: 103.9, stroke: 90.9, rod: 158.5, cyl: 8, cr: 9.5, deck: 234.9 },
    "Dodge 8.4L Viper V10": { bore: 103.0, stroke: 100.6, rod: 158.5, cyl: 10, cr: 10.2, deck: 234.9 },

    // --- EURO (BMW, VW/Audi, Porsche, Mercedes) ---
    "BMW M20B25 (E30 325i)": { bore: 84.0, stroke: 75.0, rod: 135.0, cyl: 6, cr: 8.8, deck: 206.0 },
    "BMW M50B25 (E36 325i)": { bore: 84.0, stroke: 75.0, rod: 135.0, cyl: 6, cr: 10.0, deck: 210.0 },
    "BMW S54 (E46 M3)": { bore: 87.0, stroke: 91.0, rod: 139.0, cyl: 6, cr: 11.5, deck: 217.0 },
    "BMW N54 (335i Twin Turbo)": { bore: 84.0, stroke: 89.6, rod: 145.0, cyl: 6, cr: 10.2, deck: 221.0 },
    "BMW S85 (E60 M5 V10)": { bore: 92.0, stroke: 75.2, rod: 140.7, cyl: 10, cr: 12.0, deck: 217.5 },
    "VW/Audi 1.8T (20v)": { bore: 81.0, stroke: 86.4, rod: 144.0, cyl: 4, cr: 9.5, deck: 220.0 },
    "VW/Audi 2.0T TSI (EA888)": { bore: 82.5, stroke: 92.8, rod: 144.0, cyl: 4, cr: 9.6, deck: 220.0 },
    "VW VR6 2.8L (12v AAA)": { bore: 81.0, stroke: 90.2, rod: 164.0, cyl: 6, cr: 10.0, deck: 247.0 },
    "Audi 2.5L TFSI (RS3 07K)": { bore: 82.5, stroke: 92.8, rod: 144.0, cyl: 5, cr: 10.0, deck: 220.0 },
    "Audi 4.2L V8 (B7 RS4)": { bore: 84.5, stroke: 92.8, rod: 154.0, cyl: 8, cr: 12.5, deck: 228.0 },
    "Mercedes M156 (C63 AMG)": { bore: 102.2, stroke: 94.6, rod: 145.0, cyl: 8, cr: 11.3, deck: 228.0 },
    "Porsche 3.6L Flat-6 (964)": { bore: 100.0, stroke: 76.4, rod: 127.0, cyl: 6, cr: 11.3, deck: 168.0 },
    "Porsche 4.0L Flat-6 (GT3)": { bore: 102.0, stroke: 81.5, rod: 130.0, cyl: 6, cr: 13.3, deck: 173.0 },
    "Volvo Redblock B230FT": { bore: 96.0, stroke: 80.0, rod: 152.0, cyl: 4, cr: 8.7, deck: 231.7 }
    };

    // --- 2. INITIALIZATION & SEO GENERATION ---
    window.onload = function() {
        const select = document.getElementById("globalEngine");
        const seoList = document.getElementById("seo-list");

        for (const [key, val] of Object.entries(engineDatabase)) {
            // Populate Dropdown
            let option = document.createElement("option");
            option.value = key;
            option.text = key;
            select.appendChild(option);

            // Populate SEO List (Visible to Google)
            let li = document.createElement("li");
            li.innerHTML = `<strong>${key}</strong>: ${val.bore}mm Bore, ${val.stroke}mm Stroke, ${val.rod}mm Rod, ${val.deck}mm Deck.`;
            seoList.appendChild(li);
        }
    };

    // --- 3. UI LOGIC ---
    function switchTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function autoFillAll() {
        const engine = engineDatabase[document.getElementById("globalEngine").value];
        if (!engine) return;

        // Auto-fill Basic Inputs
        setVal("disp_bore", engine.bore); setVal("disp_stroke", engine.stroke); setVal("disp_cyl", engine.cyl);
        setVal("bs_bore", engine.bore); setVal("bs_stroke", engine.stroke);
        setVal("rs_rod", engine.rod); setVal("rs_stroke", engine.stroke);
        setVal("mps_stroke", engine.stroke);
        setVal("dcr_rod", engine.rod); setVal("dcr_stroke", engine.stroke); setVal("dcr_static", engine.cr);

        // Auto-fill Rod Calc Inputs
        setVal("rod_deck", engine.deck);
        setVal("rod_stroke", engine.stroke);
        
        // Calculate Stock Compression Height (approximate)
        // Formula: CompHeight = Deck - Rod - (Stroke/2)
        const compHeight = engine.deck - engine.rod - (engine.stroke / 2);
        setVal("rod_comp_height", compHeight.toFixed(2));
        setVal("rod_clearance", 0); // Assume stock is approx flush

        // Run basic calc to populate secondary fields
        calcDisplacement(); 
    }

    // --- 4. CALCULATOR MATH ---
    function calcDisplacement() {
        const b = getVal("disp_bore"), s = getVal("disp_stroke"), c = getVal("disp_cyl");
        if(b && s && c) {
            const cc = (Math.PI * Math.pow(b/2, 2) * s * c) / 1000;
            document.getElementById("res_disp").innerText = `${cc.toFixed(0)} cc / ${(cc/1000).toFixed(1)} L`;
            document.getElementById("cr_cylvol").value = ((Math.PI * Math.pow(b/2, 2) * s) / 1000).toFixed(2);
            document.getElementById("cfm_liters").value = (cc/1000).toFixed(1);
        }
    }

    function calcRodLength() {
        const deck = getVal("rod_deck");
        const stroke = getVal("rod_stroke");
        const compH = getVal("rod_comp_height");
        const clear = getVal("rod_clearance") || 0;

        // Rod = Deck - (Stroke/2) - CompHeight - Clearance
        if (deck && stroke && compH) {
            const rod = deck - (stroke / 2) - compH - clear;
            document.getElementById("res_rod_len").innerText = `${rod.toFixed(2)} mm`;
        }
    }

    function calcCR() {
        const cyl = getVal("cr_cylvol"), chamber = getVal("cr_chamber"), dome = getVal("cr_dome") || 0;
        if (cyl && chamber) {
            const cr = (cyl + chamber + dome) / (chamber + dome);
            document.getElementById("res_cr").innerText = `${cr.toFixed(1)} : 1`;
        }
    }

    function calcRSRatio() {
        const r = getVal("rs_rod"), s = getVal("rs_stroke");
        if(r && s) document.getElementById("res_rs").innerText = `Ratio: ${(r/s).toFixed(2)}`;
    }

    function calcBSRatio() {
        const b = getVal("bs_bore"), s = getVal("bs_stroke");
        if(b && s) {
            const r = b/s;
            document.getElementById("res_bs").innerText = `${r.toFixed(2)} (${r>1 ? 'Over-Square' : 'Under-Square'})`;
        }
    }

    function calcCFM() {
        const l = getVal("cfm_liters"), rpm = getVal("cfm_rpm"), ve = getVal("cfm_ve");
        if(l && rpm && ve) {
            const cid = l * 61.0237;
            const cfm = (cid * rpm * (ve/100)) / 3456;
            document.getElementById("res_cfm").innerText = `${cfm.toFixed(0)} CFM`;
        }
    }

    function calcInjectors() {
        const hp = getVal("inj_hp"), num = getVal("inj_num"), bsfc = getVal("inj_bsfc"), duty = getVal("inj_duty");
        if(hp && num) {
            const lbsHr = (hp * bsfc) / (num * (duty/100));
            document.getElementById("res_inj").innerText = `${(lbsHr * 10.5).toFixed(0)} cc/min`;
        }
    }

    function calcPistonSpeed() {
        const s = getVal("mps_stroke"), rpm = getVal("mps_rpm");
        if(s && rpm) {
            const fpm = ((s / 25.4) * rpm) / 6;
            document.getElementById("res_mps").innerText = `${fpm.toFixed(0)} ft/min`;
        }
    }

    function calcDCR() {
        const stat = getVal("dcr_static"), ivc = getVal("dcr_ivc");
        if(stat && ivc) {
            const factor = 1 - (ivc/180)*0.5; 
            document.getElementById("res_dcr").innerText = `Est. ${ (stat * factor).toFixed(1) } : 1`; 
        }
    }

    function calcSpeed() {
        const tire = getVal("gear_tire"), final = getVal("gear_final"), ratio = getVal("gear_ratio"), rpm = getVal("gear_rpm");
        if(tire && final && ratio && rpm) {
            const mph = (rpm * tire) / (final * ratio * 336);
            document.getElementById("res_speed").innerText = `${mph.toFixed(1)} mph`;
        }
    }

    function calcTireDiff() {
        const p1 = parseTire(document.getElementById("tire1").value);
        const p2 = parseTire(document.getElementById("tire2").value);
        if(p1 && p2) {
            const diff = ((p2 - p1) / p1) * 100;
            document.getElementById("res_tire").innerText = `Diff: ${diff > 0 ? '+' : ''}${diff.toFixed(2)}%`;
        } else {
             document.getElementById("res_tire").innerText = "Invalid Format";
        }
    }

    function getVal(id) { return parseFloat(document.getElementById(id).value); }
    function setVal(id, val) { document.getElementById(id).value = val; }
    function parseTire(str) {
        const p = str.match(/(\d{3})[\/](\d{2})[R\/z]?(\d{2})/i);
        if(p) return (parseFloat(p[1]) * (parseFloat(p[2])/100) * 2 / 25.4) + parseFloat(p[3]);
        return null;
    }
</script>
</body>
</html>
